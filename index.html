<!DOCTYPE html>
<html lang="te">
<head>
<meta charset="UTF-8">
<title>‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç & ‡∞∑‡∞æ‡∞™‡±ç ‡∞Ø‡∞æ‡∞™‡±ç</title>
<style>
body{font-family:"Noto Sans Telugu",Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px;}
h1,h2{color:#222;}
.box{background:#fff;padding:15px;margin-bottom:10px;border-radius:8px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
input,select{padding:6px;margin:5px 0;border:1px solid #ccc;border-radius:6px;width:95%;}
button{padding:6px 12px;border-radius:6px;background:#007bff;color:white;border:none;cursor:pointer;margin-top:5px;}
button:hover{background:#0056b3;}
#login,#dashboard{max-width:700px;margin:auto;}
.total{font-weight:bold;margin-top:10px;font-size:18px;color:#333;}
</style>
</head>
<body>

<div id="login">
<h1>üì± ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç / ‡∞∏‡±à‡∞®‡±ç ‡∞Ö‡∞™‡±ç</h1>
<input type="text" id="phone" placeholder="‡∞´‡±ã‡∞®‡±ç ‡∞®‡±Ü‡∞Ç‡∞¨‡∞∞‡±ç"><br>
<input type="text" id="name" placeholder="‡∞™‡±á‡∞∞‡±Å (‡∞∏‡±à‡∞®‡±ç ‡∞Ö‡∞™‡±ç ‡∞ï‡±ã‡∞∏‡∞Ç)"><br>
<button onclick="signupLogin()">‡∞∏‡±à‡∞®‡±ç ‡∞Ö‡∞™‡±ç / ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç</button>
</div>

<div id="dashboard" style="display:none;">
<h1 id="welcome"></h1>

<div id="adminPanel" style="display:none;">
<h2>üè¨ ‡∞∑‡∞æ‡∞™‡±ç & ‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç‡∞≤‡±Å</h2>

<div>
<label>‡∞∑‡∞æ‡∞™‡±ç ‡∞™‡±á‡∞∞‡±Å:</label><input type="text" id="shopName">
<button onclick="createShop()">‡∞∑‡∞æ‡∞™‡±ç ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡±Å</button>
</div>

<div>
<h3>‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡±Å</h3>
<select id="userSelect"></select>
<button onclick="addCustomer()">‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡±Å</button>
</div>

<div>
<h3>‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞µ‡±Å‡∞≤‡±Å</h3>
<input placeholder="‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞µ‡±Å ‡∞™‡±á‡∞∞‡±Å" id="itemName">
<input placeholder="‡∞¨‡∞∞‡±Å‡∞µ‡±Å" id="itemWeight">
<input type="number" placeholder="‡∞¨‡±ç‡∞Ø‡∞æ‡∞ó‡±Å‡∞≤‡±Å" id="itemBags">
<input type="number" placeholder="‡∞ß‡∞∞" id="itemPrice">
<button onclick="addItem()">‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞µ‡±Å ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡±Å</button>
<div id="itemsList"></div>
</div>

<div>
<h3>‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç‡∞≤‡±Å</h3>
<div id="customerList"></div>
</div>
</div>

<div id="customerPanel" style="display:none;">
<h2>üõí ‡∞Æ‡±Ä ‡∞∑‡∞æ‡∞™‡±Å‡∞≤‡±Å</h2>
<div id="shopsList"></div>
<div id="shopItems"></div>
</div>

</div>

<script>
const API="http://localhost:5000"; // Replace with your backend if cloud
let currentUser=null;
let currentAdmin=null;

// Signup/Login
async function signupLogin(){
let phone=document.getElementById("phone").value.trim();
let name=document.getElementById("name").value.trim();
if(!phone) return alert("‡∞´‡±ã‡∞®‡±ç ‡∞®‡±Ü‡∞Ç‡∞¨‡∞∞‡±ç ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø");

// Signup
await fetch(API+"/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone,name})});

// Login
let loginRes=await fetch(API+"/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone})});
let loginData=await loginRes.json();
currentUser=loginData.user;

document.getElementById("login").style.display="none";
document.getElementById("dashboard").style.display="block";
document.getElementById("welcome").innerText=`‡∞π‡∞≤‡±ã, ${currentUser.name}`;

if(loginData.admin){
  currentAdmin=loginData.admin;
  showAdminPanel();
}else{
  showCustomerPanel();
}
}

// Admin Panel
async function showAdminPanel(){
document.getElementById("adminPanel").style.display="block";
await loadUsersDropdown();
loadItems();
loadCustomers();
}

// Load Users Dropdown for Admin to pick customers
async function loadUsersDropdown(){
let res = await fetch(API+"/allUsers"); // Backend should provide /allUsers endpoint
let users = await res.json();
let select = document.getElementById("userSelect");
select.innerHTML="";
users.forEach(u=>{
  if(u.id !== currentUser.id) select.innerHTML += `<option value="${u.id}">${u.name}</option>`;
});
}

// Create Shop
async function createShop(){
let shopName=document.getElementById("shopName").value.trim();
if(!shopName) return alert("‡∞∑‡∞æ‡∞™‡±ç ‡∞™‡±á‡∞∞‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞Ç‡∞°‡∞ø");
let res=await fetch(API+"/admin/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:currentUser.id,shopName})});
let data=await res.json();
currentAdmin=data.admin;
alert("‡∞∑‡∞æ‡∞™‡±ç ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø");
showAdminPanel();
}

// Add Customer
async function addCustomer(){
let userId=document.getElementById("userSelect").value;
if(!userId) return alert("‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç ‡∞é‡∞Ç‡∞™‡∞ø‡∞ï ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø");
await fetch(API+"/admin/addCustomer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminId:currentAdmin.id,userId})});
alert("‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç ‡∞ú‡±ã‡∞°‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø");
loadCustomers();
}

// Add Item
async function addItem(){
let name=document.getElementById("itemName").value;
let weight=document.getElementById("itemWeight").value;
let bags=document.getElementById("itemBags").value;
let price=document.getElementById("itemPrice").value;
if(!name || !weight || !bags || !price) return alert("‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞´‡±Ä‡∞≤‡±ç‡∞°‡±ç‡∞∏‡±ç ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø");
let res=await fetch(`${API}/items/${currentAdmin.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name,weight,bags:Number(bags),price:Number(price)})});
let data=await res.json();
loadItems();
}

// Load Items
async function loadItems(){
let res=await fetch(`${API}/items/${currentAdmin.id}`);
let items=await res.json();
let container=document.getElementById("itemsList");
container.innerHTML="";
let total=0;
items.forEach(i=>{
total+=i["‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç"];
let div=document.createElement("div");
div.className="box";
div.innerHTML=`${i["‡∞™‡±á‡∞∞‡±Å"]} - ${i["‡∞¨‡∞∞‡±Å‡∞µ‡±Å"]} | ${i["‡∞¨‡±ç‡∞Ø‡∞æ‡∞ó‡±Å‡∞≤‡±Å"]} ‡∞¨‡±ç‡∞Ø‡∞æ‡∞ó‡±Å‡∞≤‡±Å | ‡∞ß‡∞∞: ‚Çπ${i["‡∞ß‡∞∞"]} | ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ${i["‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç"]}`;
container.appendChild(div);
});
container.innerHTML+=`<div class="total">‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ${total}</div>`;
}

// Load Customers
async function loadCustomers(){
let res=await fetch(`${API}/customers/${currentAdmin.id}`);
let customers=await res.json();
let container=document.getElementById("customerList");
container.innerHTML="";
customers.forEach(c=>{
let div=document.createElement("div");
div.className="box";
div.innerText=c.name;
container.appendChild(div);
});
}

// Customer Panel
async function showCustomerPanel(){
document.getElementById("customerPanel").style.display="block";
let res=await fetch(`${API}/myShops/${currentUser.id}`);
let shops=await res.json();
let container=document.getElementById("shopsList");
container.innerHTML="";
shops.forEach(s=>{
let div=document.createElement("div");
div.className="box";
div.innerHTML=`${s.shopName} <button onclick="showShopItems(${s.id},'${s.shopName}', '${s.phoneNumber}')">‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø</button>`;
container.appendChild(div);
});
}

async function showShopItems(adminId, shopName, adminPhone){
let res=await fetch(`${API}/items/${adminId}`);
let items=await res.json();
let container=document.getElementById("shopItems");
container.innerHTML="<h3>‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞µ‡±Å‡∞≤‡±Å</h3>";
let total=0;
let orderText=`‡∞Æ‡±Ä‡∞∞‡±Å ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±á‡∞∏‡∞æ‡∞∞‡±Å:\n‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç: ${currentUser.name}\n‡∞∑‡∞æ‡∞™‡±ç: ${shopName}\n‡∞µ‡∞∏‡±ç‡∞§‡±Å‡∞µ‡±Å‡∞≤‡±Å:\n`;
items.forEach(i=>{
total+=i["‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç"];
let div=document.createElement("div");
div.className="box";
div.innerHTML=`${i["‡∞™‡±á‡∞∞‡±Å"]} - ${i["‡∞¨‡∞∞‡±Å‡∞µ‡±Å"]} | ${i["‡∞¨‡±ç‡∞Ø‡∞æ‡∞ó‡±Å‡∞≤‡±Å"]} ‡∞¨‡±ç‡∞Ø‡∞æ‡∞ó‡±Å‡∞≤‡±Å | ‡∞ß‡∞∞: ‚Çπ${i["‡∞ß‡∞∞"]} | ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ${i["‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç"]}`;
container.appendChild(div);
orderText += `- ${i["‡∞™‡±á‡∞∞‡±Å"]}: ${i["‡∞¨‡±ç‡∞Ø‡∞æ‡∞ó‡±Å‡∞≤‡±Å"]} ‡∞¨‡±ç‡∞Ø‡∞æ‡∞ó‡±Å‡∞≤‡±Å\n`;
});
orderText += `‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ${total}\n`;

let orderBtn = document.createElement("button");
orderBtn.innerText="WhatsApp ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞Ü‡∞∞‡±ç‡∞°‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡±Å";
orderBtn.onclick=()=>openWhatsApp(adminPhone, orderText);
container.appendChild(orderBtn);
container.innerHTML+=`<div class="total">‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ${total}</div>`;
}

function openWhatsApp(adminNumber, orderText){
const encodedText = encodeURIComponent(orderText);
const url = `https://wa.me/${adminNumber}?text=${encodedText}`;
window.open(url,"_blank");
}
</script>

</body>
</html>

